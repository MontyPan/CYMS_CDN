<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<!-- Custom CSS -->
	<link href="css/pageStyle.css" rel='stylesheet' type='text/css' />


	<!-- Bootstrap Core CSS -->
	<link href="css/bootstrap.css" rel='stylesheet' type='text/css' />

	<!-- Custom CSS -->
	<link href="css/healthCheck_style.css" rel='stylesheet' type='text/css' />

	<!-- font-awesome icons CSS -->
	<link href="css/font-awesome.css" rel="stylesheet">
	<!-- //font-awesome icons CSS-->

	<!-- side nav css file -->
	<link href='css/SidebarNav.min.css' media='all' rel='stylesheet' type='text/css' />
	<!-- //side nav css file -->

	<!-- js-->
	<script src="js/jquery-1.11.1.min.js"></script>
	<script src="js/modernizr.custom.js"></script>

	<!--webfonts-->
	<link href="//fonts.googleapis.com/css?family=PT+Sans:400,400i,700,700i&amp;subset=cyrillic,cyrillic-ext,latin-ext" rel="stylesheet">
	<!--//webfonts-->

	<!-- chart -->
	<script src="js/Chart.js"></script>
	<!-- //chart -->

	<!-- Metis Menu -->
	<script src="js/metisMenu.min.js"></script>
	<script src="js/custom.js"></script>
	<link href="css/custom.css" rel="stylesheet">
	<style type="text/css">
		body,
		html,
		#allmap {
			width: 100%;
			height: 100%;
			overflow: hidden;
			margin: 0;
			font-family: "微软雅黑";
		}

		#l-map {
			height: 100%;
			width: 78%;
			float: left;
			border-right: 2px solid #bcbcbc;
		}

		#r-result {
			height: 100%;
			width: 20%;
			float: left;
		}
	</style>
	<script type="text/javascript"
		src="https://api.map.baidu.com/api?v=2.0&ak=ZKD67I7AyqRnSkVbaVSshkQfiG9ipHsy"></script>
	<title data-i18n="footprint"></title>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
	
	<link rel="shortcut icon" type="image/ico" href="images/favicon.ico" />
	<!--<meta name="viewport" content="width=device-width, initial-scale=1">-->
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content="Glance Design Dashboard Responsive web template, Bootstrap Web Templates, Flat Web Templates, Android Compatible web template, 
SmartPhone Compatible web template, free WebDesigns for Nokia, Samsung, LG, SonyEricsson, Motorola web design" />
	<meta HTTP-EQUIV="pragma" CONTENT="no-cache">
	<meta HTTP-EQUIV="Cache-Control" CONTENT="no-cache, must-revalidate">
	<meta HTTP-EQUIV="expires" CONTENT="0">
	<script
		type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>


	<!-- js-->
	<script src="js/jquery-1.11.1.min.js"></script>
	<script src="js/modernizr.custom.js"></script>

	<!--webfonts-->
	<link href="//fonts.googleapis.com/css?family=PT+Sans:400,400i,700,700i&amp;subset=cyrillic,cyrillic-ext,latin-ext"
		rel="stylesheet">
	<!--//webfonts-->

	<!-- chart -->
	<script src="js/Chart.js"></script>
	<!-- //chart -->

	<!-- Metis Menu -->
	<script src="js/metisMenu.min.js"></script>
	<link href="css/custom.css" rel="stylesheet">
	<!--//Metis Menu -->

	<script src="js/setting.js"></script>
	<script src="js/custom.js"></script>

	<!--pie-chart -->
	<!-- index page sales reviews visitors pie chart -->
	<script src="js/pie-chart.js" type="text/javascript"></script>
	
	</script>
	<!-- //pie-chart -->
	<!-- index page sales reviews visitors pie chart -->

	<!-- requried-jsfiles-for owl -->
	<link href="css/owl.carousel.css" rel="stylesheet">
	<script src="js/owl.carousel.js"></script>
	<script language='javascript'>
		$(function () {
			$('#test').click(function () {
				$('#page-wrapper').animate({ scrollTop: $('#ttest').offset().top }, 800);
			}); //代表一個完整的執行區塊
		});
	</script>
	<script src="js/physical.js" type="text/javascript"></script>
	<script src="js/modal.js" type="text/javascript"></script>
	<link href="css/modal.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="css/numPad.css">
	<script type="text/javascript" src='js/jquery-1.12.4.min.js'></script>
	<script type="text/javascript" src="js/numKeyBoard.js"></script>
	<!-- //requried-jsfiles-for owl -->

	<!-- i18n -->
	<script src="js/DontCareCommon.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.7/jquery.i18n.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.7/jquery.i18n.messagestore.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.7/jquery.i18n.parser.min.js"></script>
	<script type="text/javascript">
		$(document).ready(function () {
			prepareI18N(customI18N);
		});

		function customI18N() {
			$("#op_1").text($.i18n("mins", "1"));
			$("#op_2").text($.i18n("hours", "1"));
			$("#op_3").text($.i18n("hours", "3"));
		}

	</script>
</head>

<body class="cbp-spmenu-push" onload="add_control();">
	<div class="main-content">
		<!-- header-starts -->
		<div class="sticky-header header-section ">
			<div class="header-left">
				<!--toggle button start-->
				<button id="showLeftPush" onclick="window.location.href='Home.html'">
					<i class="fa fa-arrow-left"></i>
				</button>
				<!--toggle button end-->
				<div class="profile_details_left" style="width: 85%; float: left; position: absolute; left: 15%;">
					<!--notifications of menu start -->
					<div class="col-xs-12" style="font-size: 4vmax;text-align: center;">
						<span><img src="images/images.png" width="50%">
							<span><img src="images/qrcode.png" style="float: right;margin-top: 11px; opacity: 0;"
									width="50px"></span>
							<div class="clearfix"> </div>
					</div>
				</div>

				<!--notification menu end -->
				<div class="clearfix">
				</div>
			</div>


			<div class="clearfix"> </div>
		</div>
		<div id="page-wrapper">
			<div class="main-page">
				<div style="height:10%;text-align:center;" data-i18n="time_block"></div>
				<select id="mySelect" onchange="time_range_onchange()">
						<option id="op_1" value="1" ></option>
						<option id="op_2" value="2" ></option>
						<option id="op_3" value="3" ></option>
						<option value="4" data-i18n="all_record"></option>
					</select>
					<span id="location" style="text-align:center; display:block;"></span></div>
					<div id="allmap" style="height:87%"></div>
			</div>
		</div>
	</div>
	<div style="height:3%"></div>
	<!--footer-->
	<div class="footer">
		<p>&copy; 2020-2022 京阳(南京) Kinyoung All Rights Reserved.
		</p>
	</div>
	<!--//footer-->
	
</body>

</html>
<script type="text/javascript">
	// 百度地图API功能
	var map = new BMap.Map("allmap");
	var point = new BMap.Point(116.404, 39.915);
	map.centerAndZoom(point, 20);

	// 编写自定义函数,创建标注
	function addMarker(point) {
		var marker = new BMap.Marker(point);
		map.addOverlay(marker);
	}


	var data = {};
	data.uid = getLocalStorageItem("uid");
	data.time_range = 1;
	var url = api_url + "/cyms/return_realtime_location.php";
	$.ajax({
		type: "POST",
		data: { "requestObject": JSON.stringify(data) },
		dataType: "json",
		url: url,
		success: function (data) {
			console.log(data);
			if (data.success === 200) {
				document.getElementById("location").innerHTML = $.i18n("search_GPS_message_in_10_mins", data.objects.length);
				if (data.objects.length > 0) {

					var point = new BMap.Point(data.objects[data.objects.length - 1].longitude, data.objects[data.objects.length - 1].latitude);
					map.centerAndZoom(point, 20);



					// 创建标注
					for (var i = 0; i < data.objects.length; i++) {
						var point = new BMap.Point(data.objects[i].longitude, data.objects[i].latitude);

						var marker = new BMap.Marker(point);
						map.addOverlay(marker);              // 将标注添加到地图中
						var label = new BMap.Label(data.objects[i].locate_time, { offset: new BMap.Size(20, -10) });
						label.setStyle({
                                "max-width" : "none"
                            });
						marker.setLabel(label);
						addMarker(point);
					}



					// 随机向地图添加25个标注
					// <!-- var bounds = map.getBounds(); -->
					// <!-- var sw = bounds.getSouthWest(); -->
					// <!-- var ne = bounds.getNorthEast(); -->
					// <!-- var lngSpan = Math.abs(sw.lng - ne.lng); -->
					// <!-- var latSpan = Math.abs(ne.lat - sw.lat); -->
					// <!-- for (var i = 0; i < 25; i ++) { -->
					// 	<!-- var point = new BMap.Point(sw.lng + lngSpan * (Math.random() * 0.7), ne.lat - latSpan * (Math.random() * 0.7)); -->
					//   <!-- var marker = new BMap.Marker(point);  // 创建标注 -->
					// <!-- map.addOverlay(marker);              // 将标注添加到地图中 -->

					// <!-- var label = new BMap.Label("我是文字标注哦",{offset:new BMap.Size(20,-10)}); -->
					// <!-- marker.setLabel(label); -->
					// 	<!-- addMarker(point); -->
					// <!-- } -->



				}

			}
			else {
				//setEmptyList();
			}
		},
		error: function (jqXHR, textStatus, errorThrown) {
			//alert("ajax error:" + jqXHR.responseText);
		}
	});


	var top_left_control = new BMap.ScaleControl({ anchor: BMAP_ANCHOR_TOP_LEFT });// 左上角，添加比例尺
	var top_left_navigation = new BMap.NavigationControl();  //左上角，添加默认缩放平移控件
	var top_right_navigation = new BMap.NavigationControl({ anchor: BMAP_ANCHOR_TOP_RIGHT, type: BMAP_NAVIGATION_CONTROL_SMALL }); //右上角，仅包含平移和缩放按钮
	/*缩放控件type有四种类型:
	BMAP_NAVIGATION_CONTROL_SMALL：仅包含平移和缩放按钮；BMAP_NAVIGATION_CONTROL_PAN:仅包含平移按钮；BMAP_NAVIGATION_CONTROL_ZOOM：仅包含缩放按钮*/

	//添加控件和比例尺
	function add_control() {
		map.addControl(top_left_control);
		map.addControl(top_left_navigation);
		map.addControl(top_right_navigation);
	}

	// <!-- var geolocation = new BMap.Geolocation(); -->
	// <!-- geolocation.getCurrentPosition(function(r){ -->
	// 	<!-- if(this.getStatus() == BMAP_STATUS_SUCCESS){ -->
	// 		<!-- var mk = new BMap.Marker(r.point); -->
	// 		<!-- map.addOverlay(mk); -->
	// 		<!-- map.panTo(r.point); -->
	// 		<!-- alert('您的位置：'+r.point.lng+','+r.point.lat); -->
	// 	<!-- } -->
	// 	<!-- else { -->
	// 		<!-- alert('failed'+this.getStatus()); -->
	// 	<!-- }         -->
	// <!-- },{enableHighAccuracy: true}) -->


	//关于状态码
	//BMAP_STATUS_SUCCESS	检索成功。对应数值“0”。
	//BMAP_STATUS_CITY_LIST	城市列表。对应数值“1”。
	//BMAP_STATUS_UNKNOWN_LOCATION	位置结果未知。对应数值“2”。
	//BMAP_STATUS_UNKNOWN_ROUTE	导航结果未知。对应数值“3”。
	//BMAP_STATUS_INVALID_KEY	非法密钥。对应数值“4”。
	//BMAP_STATUS_INVALID_REQUEST	非法请求。对应数值“5”。
	//BMAP_STATUS_PERMISSION_DENIED	没有权限。对应数值“6”。(自 1.1 新增)
	//BMAP_STATUS_SERVICE_UNAVAILABLE	服务不可用。对应数值“7”。(自 1.1 新增)
	//BMAP_STATUS_TIMEOUT	超时。对应数值“8”。(自 1.1 新增)
	function time_range_onchange() {
		var map = new BMap.Map("allmap");
		var point = new BMap.Point(116.404, 39.915);
		map.centerAndZoom(point, 20);



		var data = {};
		data.uid = getLocalStorageItem("uid");
		data.time_range = document.getElementById("mySelect").value;;
		var url = api_url + "/cyms/return_realtime_location.php";
		$.ajax({
			type: "POST",
			data: { "requestObject": JSON.stringify(data) },
			dataType: "json",
			url: url,
			success: function (data) {
				console.log(data);
				if (data.success === 200) {
					var sel = document.getElementById("mySelect");
					var text = sel.options[sel.selectedIndex].text;
					document.getElementById("location").innerHTML = $.i18n("search_GPS_message_total_result" ,text, data.objects.length);
					if (data.objects.length > 0) {

						var point = new BMap.Point(data.objects[data.objects.length - 1].longitude, data.objects[data.objects.length - 1].latitude);
						map.centerAndZoom(point, 20);



						// 创建标注
						var i = 0;
						for (i = 0; i < data.objects.length; i++) {
							var point = new BMap.Point(data.objects[i].longitude, data.objects[i].latitude);

							var marker = new BMap.Marker(point);
							map.addOverlay(marker);              // 将标注添加到地图中
							var label = new BMap.Label(data.objects[i].locate_time, { offset: new BMap.Size(20, -10) });
							label.setStyle({
                                "max-width" : "none"
                            });
							marker.setLabel(label);
							addMarker(point);
						}
						add_control();


					}

				}
				else {
					//setEmptyList();
				}
			},
			error: function (jqXHR, textStatus, errorThrown) {
				//alert("ajax error:" + jqXHR.responseText);
			}
		});
	}
</script>